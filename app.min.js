// 添加更详细的错误处理
$(document).ready(function() {
    try {
        // 原有代码
    } catch(e) {
        console.error("发生错误:", e);
        // 显示用户友好的错误提示
        alert("页面加载出现问题,请刷新重试");
    }
});

// 添加图片懒加载
document.addEventListener("DOMContentLoaded", function() {
    const images = document.querySelectorAll("img[data-src]");
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                img.removeAttribute("data-src");
                observer.unobserve(img);
            }
        });
    });
    
    images.forEach(img => imageObserver.observe(img));
});

// 优化模态框显示/隐藏
function showModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = "block";
        document.body.classList.add("modal-open");
        setTimeout(() => modal.classList.add("show"), 10);
    }
}

// 简化的轮播图功能
function initSlider() {
    const $slider = $('.campus-slider');
    if (!$slider.length) return;

    const $slides = $slider.find('.slide');
    const $dots = $slider.find('.slider-dot');
    const slideCount = $slides.length;
    let currentSlide = 0;
    
    // 初始化
    $slides.hide();
    $slides.eq(0).show();
    
    // 切换到指定幻灯片
    function goToSlide(index) {
        $slides.fadeOut(400);
        $slides.eq(index).fadeIn(400);
        $dots.removeClass('active');
        $dots.eq(index).addClass('active');
        currentSlide = index;
    }
    
    // 下一张
    function nextSlide() {
        goToSlide((currentSlide + 1) % slideCount);
    }
    
    // 上一张
    function prevSlide() {
        goToSlide((currentSlide - 1 + slideCount) % slideCount);
    }
    
    // 自动播放
    let autoPlay = setInterval(nextSlide, 5000);
    
    // 鼠标悬停暂停
    $slider.hover(
        () => clearInterval(autoPlay),
        () => autoPlay = setInterval(nextSlide, 5000)
    );
    
    // 点击导航点
    $dots.click(function() {
        goToSlide($(this).index());
    });
    
    // 触摸支持
    let touchStartX = 0;
    
    $slider.on('touchstart', function(e) {
        touchStartX = e.originalEvent.touches[0].clientX;
    });
    
    $slider.on('touchend', function(e) {
        const touchEndX = e.originalEvent.changedTouches[0].clientX;
        const diff = touchStartX - touchEndX;
        
        if (Math.abs(diff) > 50) {
            if (diff > 0) {
                nextSlide();
            } else {
                prevSlide();
            }
        }
    });
}

// 页面加载完成后初始化
$(document).ready(function() {
    initSlider();
});

// 全局函数，用于关闭弹窗
function closeNotice() {
    const notice = document.getElementById('siteNotice');
    if (notice) {
        notice.style.display = 'none';
        document.body.style.overflow = '';
    }
}

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    const notice = document.getElementById('siteNotice');
    if (notice) {
        // 显示弹窗
        notice.style.display = 'flex';
        // 禁止页面滚动
        document.body.style.overflow = 'hidden';
        
        // ESC键关闭
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeNotice();
            }
        });
        
        // 点击外部区域关闭
        notice.addEventListener('click', function(e) {
            if (e.target === notice) {
                closeNotice();
            }
        });
    }
}); 